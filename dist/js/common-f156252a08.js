var URL="https://vending.jianlangcn.com/machine/";$(function(){FastClick.attach(document.body)});var common={vmCoupon:function(s){$.ajax({type:"post",url:URL+"pay/weixin/vmCoupon",dataType:"json",data:s,success:function(e){if(console.log(e),200==e.status){var t=e.data.payFee,a=s.totalFee-t;a*=.01,t*=.01,$("#price1").html(t.toFixed(2)),$("#price3").html(a.toFixed(2)),sessionStorage.setItem("coupSn",e.data.coupSn)}}})},createOrder:function(e){$.ajax({type:"post",url:URL+"pay/weixin/createOrder",dataType:"json",data:e,success:function(e){if(console.log(e),200==e.status){var t=e.data;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.packageValue,signType:t.signType,paySign:t.paySign},function(e){console.log(e),e.err_msg})}}})},couponInfo:function(e){$.ajax({type:"get",url:URL+"jl/coup/wxinfo/"+e,dataType:"json",async:!1,success:function(n){200==n.status&&$.ajax({type:"get",url:URL+"jl/dr/wxinfo/"+n.data.jlDrPk,async:!1,dataType:"json",success:function(i){var e={w:[{k:"jlHospPk",v:i.data.jlHospPk,m:"LK"}],o:[],p:{n:1,s:10}};e=JSON.stringify(e),e=encodeURI(e),200==i.status&&$.ajax({type:"get",url:URL+"jl/vm/wxlist?query="+e,async:!1,dataType:"json",success:function(e){$("#jlHospNm").html(i.data.jlHospNm),$("#dateLimit").html(n.data.dateLimit),$("#jlHospNm2").html(i.data.jlHospNm),$("#dateLimit2").html(n.data.dateLimit),$("#coupSn").html(n.data.coupSn);for(var t=e.data.items,a="",s=0;s<t.length;s++){0==s?a=a+""+t[s].addrDet:t[s].addrDet;var o='<div class="list flex-box"><div class="list-left"><div class="circle"></div></div><div class="list-right flex1"><div class="number flex-box"><p class="number-left">NO：'+t[s].vmSn+'</p><p class="number-right">'+t[s].depNm+'</p></div><p class="texts">'+t[s].addrDet+"</p></div></div>";$("#coupList").append(o)}$("#addrDet").html(a)}})}})}})},wxedit:function(e){e=JSON.stringify(e),$.ajax({type:"post",data:e,dataType:"json",url:URL+"jl/fb/wxedit",contentType:"application/json",success:function(e){console.log(e),200==e.status&&($.toast("提交成功"),sessionStorage.removeItem("info"),setTimeout(function(){location.reload()},500))}})},coupList:function(e){var o='<div class="weui-loadmore weui-loadmore_line"><span class="weui-loadmore__tips">暂无数据</span></div>';$(".content").html('<div class="weui-loadmore"><i class="weui-loading"></i><span class="weui-loadmore__tips">正在加载</span></div>'),$.ajax({type:"get",url:URL+"jl/coup/wxcoupList?jlCsrPk="+e,dataType:"json",success:function(e){if(200==e.status){var t=e.data;if(t){$(".content").html("");for(var a=0;a<t.length;a++){var s='<div class="weui-flex section align-center" data-pk="'+t[a].jlCoupVo.jlCoupPk+'"><div class="borders"></div><div class="main"><p class="name">'+t[a].jlDrVo.jlHospNm+'</p><p class="time">有效期至:'+t[a].jlCoupVo.dateLimit+'</p><p class="number">NO:'+t[a].jlCoupVo.coupSn+'</p></div><div class="remove">删除</div></div>';$(".content").append(s)}}else $(".content").html(o)}else $(".content").html(o)}})},hosplist:function(e){var t="";t=e?URL+"jl/hosp/wxlist?query="+e:URL+"jl/hosp/wxlist";var o='<div class="weui-loadmore weui-loadmore_line"><span class="weui-loadmore__tips">暂无数据</span></div>';$.ajax({type:"get",url:t,dataType:"json",success:function(e){if(console.log(e),200==e.status){$("#lists").html("");var t=e.data.items;if(t)for(var a=0;a<t.length;a++){var s='<div class="list" data-id="'+t[a].jlHospPk+'"><p class="list-title">'+t[a].hospNm+"</p></div>";$("#lists").append(s)}else $("#lists").html(o)}else $("#lists").html(o)}})},scan:function(){$.ajax({url:URL+"/weixin/sign/jssign?url=https://vending.jianlangcn.com/admin/view/dist/scan.html",type:"get",dataType:"json",success:function(e){console.log(e),wx.config({debug:!1,appId:"wxfad716c770341d1d",timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["checkJsApi","scanQRCode"]}),wx.error(function(e){}),wx.ready(function(){wx.checkJsApi({jsApiList:["scanQRCode"],success:function(e){}}),wx.scanQRCode({needResult:0,scanType:["qrCode","barCode"],success:function(e){console.log(e)}})})}})},vmList2:function(e){},vmList:function(e){var t="";t=e?URL+"jl/vm/wxlist?query="+e:URL+"jl/vm/wxlist";var o='<div class="weui-loadmore weui-loadmore_line"><span class="weui-loadmore__tips">暂无数据</span></div>';$.ajax({type:"get",url:t,dataType:"json",success:function(e){if(console.log(e),200==e.status){$("#lists").html("");var t=e.data.items;if(t)for(var a=0;a<t.length;a++){var s='<div class="list"  data-id="'+t[a].jlVmPk+'"><div class="weui-flex"><div class="weui-flex__item initial-flex name" style="margin-right:30px">'+t[a].depNm+'</div><div class="weui-flex__item number">NO：'+t[a].jlVmPk+'</div></div><div class="desc">'+t[a].addrDet+"</div></div>";$("#lists").append(s)}else $("#lists").html(o)}else $("#lists").html(o)}})},hospitalDetail:function(e){$.ajax({type:"get",url:URL+"jl/hosp/wxinfo/"+e,dataType:"json",success:function(e){if(console.log(e),200==e.status)for(var t=e.data,a=0;a<t.length;a++){var s='<div class="list2" data-id="1"><div class="weui-flex"><div class="weui-flex__item initial-flex name">'+t[a].impDep+'</div><div class="weui-flex__item number">NO：'+t[a].depNo+'</div></div><div class="desc">'+t[a].info+"</div></div>";$("#lists").append(s)}},error:function(e){console.log(e)}})},edit:function(e,a){var t=localStorage.getItem("params");t=JSON.parse(t),a=$.extend(t,a),a=JSON.stringify(a),$.ajax({type:"post",url:e+"jl/csr/wxedit",data:a,dataType:"json",contentType:"application/json",success:function(e){if(console.log(e),200==e.status){$.toast("修改成功");var t=localStorage.getItem("userInfo");t=JSON.parse(t),a=JSON.parse(a),t=$.extend(t,a),t=JSON.stringify(t),a=JSON.stringify(a),localStorage.setItem("userInfo",t),localStorage.setItem("params",a),localStorage.removeItem("hasLogin"),localStorage.removeItem("openid"),setTimeout(function(){window.location.href="person-info.html"},600)}}})},getOpenid:function(e){if(localStorage.getItem("openid"));else{var t=encodeURI(e);localStorage.getItem("hasLogin")||(localStorage.setItem("hasLogin",!0),window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxfad716c770341d1d&redirect_uri="+t+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")}},getCode:function(o){var e=localStorage.getItem("openid"),i=this;if(e){var t=localStorage.getItem("userInfo");t=JSON.parse(t),i.showData(t)}else{var a=window.location.href.split("code=")[1].split("&")[0];localStorage.setItem("code",a),$.ajax({type:"get",url:URL+"weixin/access/login",data:{code:a},dataType:"json",success:function(e){if(console.log(e),200==e.status){var t=e.data.wxuser,a=e.data.userinfo;t=$.extend(t,a),console.log(t),localStorage.setItem("openid",t.openId);var s={};s.openid=t.openId,(s=$.extend(s,a)).nkNm=t.nickname,s.head_url=t.headImgUrl,s.sex=t.sexDesc,s=JSON.stringify(s),localStorage.setItem("params",s),localStorage.setItem("jlCsrPk",t.jlCsrPk),i.showData(t),t=JSON.stringify(t),localStorage.setItem("userInfo",t),localStorage.setItem("token",e.data.token),o&&o()}else 400==e.status&&(localStorage.removeItem("hasLogin"),location.reload())}})}},addCookie:function(e,t,a){var s=e+"="+escape(t);if(s+="; path=/",a&&0<a){var o=new Date,i=3600*a*1e3;o.setTime(o.getTime()+i),s+="; expires="+o.toGMTString()}document.cookie=s},set:function(e,t,a){var s=new Date,o=a;s.setTime(s.getTime()+24*o*3600*1e3),document.cookie=e+"="+t+";expires="+s.toGMTString()+"; path=/"},showData:function(e){$("#headImgUrl").attr("src",e.headImgUrl),$("#nickname").html(e.nickname),$("#picker").html(e.sexDesc),e.name&&$("#username").html(e.name),e.phone&&$("#phone").html(e.phone),(e.age||0==e.age)&&$("#picker2").html(e.age),e.addr&&$("#addr").html(e.addr)}};