accessid="LTAI9XN8UNtrxW9d",accesskey="WDVhmBr4EywOyCIGr9fC3tBrTL3Vmg",host="https://oss-cn-hangzhou.aliyuncs.com",g_dirname="",g_object_name="",g_object_name_type="",now=timestamp=Date.parse(new Date)/1e3;var policyText={expiration:"2020-01-01T12:00:00.000Z",conditions:[["content-length-range",0,1048576e3]]},policyBase64=Base64.encode(JSON.stringify(policyText));message=policyBase64;var bytes=Crypto.HMAC(Crypto.SHA1,message,accesskey,{asBytes:!0}),signature=Crypto.util.bytesToBase64(bytes);function check_object_radio(){for(var e=document.getElementsByName("myradio"),t=0;t<e.length;t++)if(e[t].checked){g_object_name_type=e[t].value;break}}function get_dirname(){dir=document.getElementById("dirname").value,""!=dir&&dir.indexOf("/")!=dir.length-1&&(dir+="/"),g_dirname=dir}function random_string(e){e=e||32;var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length,a="";for(i=0;i<e;i++)a+=t.charAt(Math.floor(Math.random()*n));return a}function get_suffix(e){return pos=e.lastIndexOf("."),suffix="",-1!=pos&&(suffix=e.substring(pos)),suffix}function calculate_object_name(e){return"local_name"==g_object_name_type?g_object_name+="${filename}":"random_name"==g_object_name_type&&(suffix=get_suffix(e),g_object_name=g_dirname+random_string(10)+suffix),""}function get_uploaded_object_name(e){return"local_name"==g_object_name_type?(tmp_name=g_object_name,tmp_name=tmp_name.replace("${filename}",e),tmp_name):"random_name"==g_object_name_type?g_object_name:void 0}function set_upload_param(e,t,n){g_object_name=g_dirname,""!=t&&(suffix=get_suffix(t),calculate_object_name(t)),new_multipart_params={key:g_object_name,policy:policyBase64,OSSAccessKeyId:accessid,success_action_status:"200",signature:signature},e.setOption({url:host,multipart_params:new_multipart_params}),e.start()}var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"selectfiles",container:document.getElementById("container"),flash_swf_url:"lib/plupload-2.1.2/js/Moxie.swf",silverlight_xap_url:"lib/plupload-2.1.2/js/Moxie.xap",url:"http://oss.aliyuncs.com",init:{PostInit:function(){document.getElementById("ossfile").innerHTML="",document.getElementById("postfiles").onclick=function(){return set_upload_param(uploader,"",!1),!1}},FilesAdded:function(e,t){plupload.each(t,function(e){console.log(e),document.getElementById("ossfile").innerHTML+='<div id="'+e.id+'">'+e.name+" ("+plupload.formatSize(e.size)+')<b></b><div class="progress"><div class="progress-bar" style="width: 0%"></div></div></div>'})},BeforeUpload:function(e,t){check_object_radio(),get_dirname(),set_upload_param(e,t.name,!0)},UploadProgress:function(e,t){var n=document.getElementById(t.id);n.getElementsByTagName("b")[0].innerHTML="<span>"+t.percent+"%</span>";var a=n.getElementsByTagName("div")[0].getElementsByTagName("div")[0];a.style.width=2*t.percent+"px",a.setAttribute("aria-valuenow",t.percent)},FileUploaded:function(e,t,n){console.log(n),200==n.status?document.getElementById(t.id).getElementsByTagName("b")[0].innerHTML="upload to oss success, object name:"+get_uploaded_object_name(t.name):document.getElementById(t.id).getElementsByTagName("b")[0].innerHTML=n.response},Error:function(e,t){document.getElementById("console").appendChild(document.createTextNode("\nError xml:"+t.response))}}});uploader.init();